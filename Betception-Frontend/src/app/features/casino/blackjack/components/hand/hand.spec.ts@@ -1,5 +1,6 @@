import { ComponentFixture, TestBed } from '@angular/core/testing';
import { Hand } from './hand';
import { CardRank, CardSuit, HandStatus, RoundHand } from '../../../../../core/api/api.types';

describe('Hand', () => {
  let component: Hand;
  let fixture: ComponentFixture<Hand>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [Hand]
    })
    .compileComponents();

    fixture = TestBed.createComponent(Hand);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should show all cards for a player hand', () => {
    component.hand = {
      id: 'player-hand',
      handValue: 20,
      status: HandStatus.ACTIVE,
      cards: [
        { id: 'c1', rank: CardRank.KING, suit: CardSuit.CLUBS, drawOrder: 0 },
        { id: 'c2', rank: CardRank.QUEEN, suit: CardSuit.DIAMONDS, drawOrder: 1 },
      ],
    };
    fixture.detectChanges();

    const cardElements = fixture.nativeElement.querySelectorAll('.card');
    expect(cardElements.length).toBe(2);
    expect(cardElements[0].classList.contains('visible')).toBe(true);
    expect(cardElements[0].classList.contains('back')).toBe(false);
    expect(cardElements[1].classList.contains('visible')).toBe(true);
    expect(cardElements[1].classList.contains('back')).toBe(false);
  });

  it('should hide the second card for a dealer hand with two cards', () => {
    component.isDealer = true;
    component.hand = {
      id: 'dealer-hand',
      handValue: null,
      status: HandStatus.ACTIVE,
      cards: [
        { id: 'c1', rank: CardRank.ACE, suit: CardSuit.SPADES, drawOrder: 0 },
        { id: 'c2', rank: CardRank.SIX, suit: CardSuit.HEARTS, drawOrder: 1 },
      ],
    };
    fixture.detectChanges();

    const cardElements = fixture.nativeElement.querySelectorAll('.card');
    expect(cardElements.length).toBe(2);

    // First card should be visible
    expect(cardElements[0].classList.contains('visible')).toBe(true);
    expect(cardElements[0].classList.contains('back')).toBe(false);

    // Second card should be hidden (face down)
    expect(cardElements[1].classList.contains('visible')).toBe(false);
    expect(cardElements[1].classList.contains('back')).toBe(true);
  });

  it('should show all cards for a dealer hand with more than two cards', () => {
    component.isDealer = true;
    component.hand = {
      id: 'dealer-hand',
      handValue: 17,
      status: HandStatus.STOOD,
      cards: [
        { id: 'c1', rank: CardRank.ACE, suit: CardSuit.SPADES, drawOrder: 0 },
        { id: c2', rank: CardRank.SIX, suit: CardSuit.HEARTS, drawOrder: 1 },
        { id: 'c3', rank: CardRank.KING, suit: CardSuit.CLUBS, drawOrder: 2 },
      ],
    };
    fixture.detectChanges();

    const cardElements = fixture.nativeElement.querySelectorAll('.card');
    expect(cardElements.length).toBe(3);

    expect(cardElements[0].classList.contains('visible')).toBe(true);
    expect(cardElements[0].classList.contains('back')).toBe(false);

    expect(cardElements[1].classList.contains('visible')).toBe(true);
    expect(cardElements[1].classList.contains('back')).toBe(false);

    expect(cardElements[2].classList.contains('visible')).toBe(true);
    expect(cardElements[2].classList.contains('back')).toBe(false);
  });
});
